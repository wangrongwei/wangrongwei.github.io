<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>gdb＋qemu联合调试linux-4.15</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h2><a id="_0"></a>说明</h2>
<p>以前使用过eclipse调试过内核，最近又想用gdb调试内核，还是比较习惯使用命令操作，但是在搭建调试内核的<strong>gdb</strong>和<strong>qemu</strong>过程中，遇到一个问题，想了很多办法，最后直接感觉到官方下载最新的<strong>gdb</strong>和<strong>qemu</strong>源码安装，以为调试内核设置断点不成功是因为使用apt安装的gdb和qemu比较旧，安装新的gdb和qemu后，还是断点没起作用，折腾了还几天，终于找到原因了。下面是作者的环境：</p>
<ul>
<li>ubuntu16.04</li>
<li>GNU gdb (GDB) 8.1.50.20180125-git</li>
<li>QEMU emulator version 2.11.0</li>
<li>linux-4.15</li>
</ul>
<hr>
<p>但是根据最后的原因，调试最新的内核可以使用apt安装的gdb和qemu</p>
<h2><a id="_12"></a>内核配置</h2>
<ul>
<li>配置调试信息<br>
与其他相关配置内核环境的教程一样，需要配置调试信息到vmlinux：<br>
<img src="http://img.blog.csdn.net/20180130160510197?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV0FOR19fUk9OR1dFSQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="图１"><br>
<strong>[*] Compile the kernel with debug info</strong>（选中这个）</li>
<li>取消KASLR<br>
如下截图所示：<br>
<img src="http://img.blog.csdn.net/20180130160901431?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV0FOR19fUk9OR1dFSQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="图２"><br>
取消选项：<br>
<strong>[ ]   Randomize the address of the kernel image (KASLR)</strong></li>
<li>说明<br>
为什么取消这个KASLR，不了解其他人在使用gdb＋qemu调试最新的内核时，是否遇到在设置的断点处，在qemu运行的系统不会暂停，直接运行到挂接文件系统，测试了很多办法，最后在<br>
<a href="https://unix.stackexchange.com/questions/396013/hardware-breakpoint-in-gdb-qemu-missing-start-kernel">https://unix.stackexchange.com/questions/396013/hardware-breakpoint-in-gdb-qemu-missing-start-kernel</a><br>
给了我提示，然后取消这个选项后，果然设置断点成功。</li>
<li>主要问题<br>
在gdb里边设置断点后，断点不起作用，qemu里运行的系统没有在相应的断点处stop，直接运行到挂接文件系统。</li>
</ul>
</div>
</body>

</html>
